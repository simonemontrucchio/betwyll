<div ng-controller="AnalyticsViewCtrl as $ctrl">

    <div id="parser" style="display:none"></div>

    <h2 ng-if="analytics.analyzed == true"><em>{{info.name}}</em> generated on {{info.date | date:'dd/MM/yyyy'}} at {{info.date | date:'HH:mm:ss'}}</h2>

    <form id="frmAddJson" role="form" ng-submit="addJson()" enctype="multipart/form-data">
        <h3>Add a new *.json file</h3>
        <div class="form-group">
            <input type="file" name="json_file" id="json_file"  on-change="$ctrl.onChange" />
        </div>

        <button type="submit" class="btn btn-success center-block">Analyze</button>
    </form>






    <div class="row" ng-if="analytics.analyzed == true">
        <div class="col-xs-12">
            Ci sono {{analytics.comments + analytics.answers}} twyll.
        </div>
        <div class="col-xs-12">
            Ci sono {{analytics.comments}} twyll originali, che sono il {{100* analytics.comments / (analytics.comments + analytics.answers) | number : 0 }}% del totale.
        </div>
        <div class="col-xs-12">
            Ci sono {{analytics.answers}} twyll di risposta, che sono il {{100* analytics.answers / (analytics.comments + analytics.answers) | number : 0 }}% del totale.
        </div>
        <div class="col-xs-12">
            Conversion: {{analytics.answers *100 / analytics.comments | number : 0 }}% (cioè 1 risposta ogni {{analytics.comments / analytics.answers | number : 0}} twyll originali circa).
        </div>

    </div>

    <hr>

    <form id="frmAdvanced" role="form" ng-submit="advanced()" enctype="multipart/form-data" ng-if="analytics.analyzed == true">
        <h3>Advanced analytics</h3>
        <div class="form-group">
        </div>

        <button type="submit" class="btn btn-success center-block">Advanced</button>
    </form>


    <div class="row" ng-if="analytics.advanced == true">
        <div class="col-xs-12">
            Ci sono {{analytics.users.length}} utenti unici attivi.
        </div>
        <div class="col-xs-12" >
            Ci sono circa {{analytics.twyll_per_user | number : 0}} twyll medi per utente.
        </div>

    </div>

    <div class="row" ng-if="analytics.advanced == true">
        <div class="col-xs-12">
            Il primo twyll è del: <em>{{analytics.twylls.first.date | date:'dd/MM/yyyy'}}</em>
        </div>
        <div class="col-xs-12">
            Il primo twyll è: <em><span ng-bind-html="analytics.twylls.first.content | trusted"></span></em>
        </div>

        <div class="col-xs-12" >
            L'ultimo twyll è del: <em>{{analytics.twylls.last.date | date:'dd/MM/yyyy'}}</em>
        </div>
        <div class="col-xs-12" >
            L'ultimo twyll è: <em><span ng-bind-html="analytics.twylls.last.content | trusted"></span></em>
        </div>




        <div class="col-xs-12" >
            Sono stati scritti twyll per {{analytics.duration | number : 0}} giorni.
        </div>
        <div class="col-xs-12" >
            Sono stati scritti  {{analytics.twyll_per_day | number : 0}} twyll per giorno.
        </div>

        <div class="col-xs-12" >
            La lunghezza media di un twyll è:  {{analytics.twylls_avgLen | number : 0}} caratteri.
        </div>
        <div class="col-xs-12" >
            La lunghezza media di un twyll originale è:  {{analytics.comments_avgLen | number : 0}} caratteri.
        </div>
        <div class="col-xs-12" >
            La lunghezza media di una risposta è:  {{analytics.answers_avgLen | number : 0}} caratteri.
        </div>


    </div>

    <hr>

    <form id="frmFiction" role="form" ng-submit="fiction()" enctype="multipart/form-data" ng-if="analytics.advanced == true">
        <h3>Fictional</h3>
        <div class="form-group">
            <input type="text" id="fiction" placeholder="@don_rodrigo, @renzo, {{analytics.users.fiction_tip}}" size="50">
            <div>Type the nicknames of the fictional (or teachers, or influencers) account, separated by comma.</div>
        </div>
        <div class="col-xs-12" ng-if="analytics.users.fiction_tip != empty">
            Gli account finzionali potrebbero essere: {{analytics.users.fiction_tip}}
        </div>
        <button type="submit" class="btn btn-success center-block">Fiction</button>
    </form>

    <div ng-if="analytics.users.fictional.length != 0" layout="row" layout-wrap ng-repeat="user in analytics.users.fictional  | orderBy:'twyllsCount':true">
        <div layout="row">Nickname: {{user.nickname}} | Twylls: {{user.twyllsCount}} | Answers: {{user.answersCount}} |
            Conversion: {{user.answersCount * 100 / user.twyllsCount | number : 0}}% (<span ng-if="(user.answersCount * 100 / user.twyllsCount) - (analytics.answers *100 / analytics.comments) >= 0">+</span>{{(user.answersCount * 100 / user.twyllsCount) - (analytics.answers *100 / analytics.comments) | number : 0 }}% rispetto alla media)</div>
        <br><br>
        <!--
        <div ng-if="user.twylls.length != 0" layout="row" layout-wrap ng-repeat="twyll in user.twylls | limitTo:3">
            <div layout="row">Nickname: {{twyll.user.nickname}} | Content: <span ng-bind-html="twyll.content | trusted"></span></div>
            <br><br><br><br>
        </div>
        -->
    </div>

    <hr>


    <div ng-if="analytics.advanced == true">
        <h3>Answers count</h3>
        <div layout-wrap ng-repeat="twyll in analytics.twylls  | orderBy :'answersCount':true | limitTo:5">

            <div>Nickname: {{twyll.user.nickname}}</div>
            <div>Content: <span ng-bind-html="twyll.content | trusted"></span></div>
            <div>Answers: {{twyll.answersCount}}</div>
            <br>
        </div>
    </div>


    <hr>

    <form id="frmHashtag" role="form" ng-submit="hashtag()" enctype="multipart/form-data" ng-if="analytics.advanced == true">
        <h3>Hashtag</h3>
        <div class="form-group">
            <input type="text" id="hashtag" placeholder="#TwContare,{{analytics.users.fiction_tip}}" size="50">
            <div>Type the hashtags of the project, separated by comma.</div>
        </div>
        <div class="col-xs-12">
            Gli hashtag protrebbero essere: {{analytics.hashtag_tip}}
        </div>
        <div class="col-xs-12" ng-if="analytics.hashtag != undefined">
            Ci sono {{analytics.hashtag}} twyll che contengono almeno un hashtag cercato.
        </div>
        <button type="submit" class="btn btn-success center-block">Hashtag</button>
    </form>


    <div ng-if="analytics.advanced == true && analytics.hashtag > 0">
        <div layout-wrap ng-repeat="twyll in analytics.twylls | filter : {hashtag:true} | limitTo:10">
                <div>Nickname: {{twyll.user.nickname}}</div>
                <div>Content: <span ng-bind-html="twyll.content | trusted"></span></div>
                <div>Hashtag: {{twyll.hashtag}}</div>
                <br>
        </div>
    </div>

        <br>
</div>
